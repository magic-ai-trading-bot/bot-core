{
  "name": "position-guardian",
  "schedule": "*/15 * * * *",
  "timeout_seconds": 300,
  "no_deliver": true,
  "prompt": "BẮT BUỘC thực hiện ĐÚNG các bước sau:\n\nBước 1: Chạy `botcore get_paper_open_trades` để xem tất cả lệnh đang mở\nBước 2: Chạy `botcore get_paper_closed_trades` để xem lệnh đóng gần đây\nBước 3: Chạy `botcore get_paper_basic_settings` để xem setting hiện tại (SL/TP/leverage)\n\nBước 4 — PHÂN TÍCH TỪNG LỆNH ĐANG MỞ:\nVới mỗi lệnh đang mở, kiểm tra:\n- PnL hiện tại bao nhiêu %?\n- Đã mở bao lâu?\n- Xu hướng giá đang đi đúng hay sai hướng?\n\nBước 5 — PHÂN TÍCH LỆNH ĐÃ ĐÓNG GẦN ĐÂY (1 giờ gần nhất):\n- Có bao nhiêu lệnh thắng vs thua?\n- Lệnh thua có hit SL quá nhanh không (< 30 phút)?\n- Nếu nhiều lệnh hit SL nhanh → SL setting quá tight\n- Nếu lệnh thắng nhưng lãi ít (< 1%) → TP có thể quá tight\n\nBước 6 — HÀNH ĐỘNG TỰ ĐỘNG (ưu tiên từ trên xuống):\n\na) CHỈNH SETTING (ưu tiên cao nhất):\n   - SL quá tight (lệnh hit SL < 30 phút liên tục) → `botcore apply_green_adjustment '{\"parameter\":\"stop_loss_percent\",\"new_value\":X,\"reasoning\":\"...\"}'`\n   - Win rate thấp (< 40% trong 10 lệnh gần nhất) → tăng `confidence_threshold` hoặc `min_required_indicators`\n   - Quá nhiều lệnh (> 5 đang mở cùng lúc, thiếu tập trung) → giảm signal interval\n\nb) CLOSE TRADE CHỦ ĐỘNG (chỉ khi đặc biệt):\n   - Lệnh đang mở mà thị trường đã đảo chiều rõ ràng (xem chart/candles nếu cần: `botcore get_candles`) → `botcore close_paper_trade_by_symbol`\n   - KHÔNG close chỉ vì lệnh đang lỗ nhẹ. Engine có SL lo rồi.\n\nc) TIGHTEN TRAILING STOP:\n   - Lệnh đang lãi > 5% → cân nhắc enable trailing stop hoặc tighten distance\n\nBước 7: Nếu đã thực hiện hành động → PHẢI chạy `botcore send_telegram_notification` báo cáo chi tiết: lệnh nào, hành động gì, lý do.\nNếu không có hành động → không cần gửi.\n\nNGUYÊN TẮC QUAN TRỌNG:\n- Engine TỰ có SL/TP → bạn KHÔNG cần close trade thay engine\n- Bạn là QUẢN LÝ: nhiệm vụ chính là CHỈNH SETTING để engine đánh tốt hơn\n- Chỉ close trade khi phát hiện thị trường đảo chiều đột ngột mà engine chưa kịp phản ứng\n- LUÔN ghi reasoning khi chỉnh setting để có audit trail\n\nLUÔN viết bằng tiếng Việt."
}
